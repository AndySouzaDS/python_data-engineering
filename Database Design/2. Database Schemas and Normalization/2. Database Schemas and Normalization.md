## Star and snowflake schema

      SNOWFLAKE SCHEMAS ------ NORMALIZE -> open in cascade data 
      STAR CHEMAS --- ------- DO NOT
## Running from star to snowflake

Remember your running database from last chapter? 

After learning about the snowflake schema, you convert the current star schema into a snowflake schema. 
To do this, you normalize route_dim and week_dim. 

--Which option best describes the resulting new tables after doing this?

The tables runs_fact, route_dim, and week_dim have been loaded.

Instructions
  - [ ] week_dim is extended two dimensions with new tables for month and year. route_dim is extended one dimension with a new table for city.
  - [x] week_dim is extended two dimensions with new tables for month and year. route_dim is extended two dimensions with new tables for city and park.
  - [ ] week_dim is extended three dimensions with new tables for week, month and year. route_dim is extended one dimension with new tables for city and park.


# Adding foreign keys

Foreign key references are essential to both the snowflake and star schema. When creating either of these schemas, correctly setting up the foreign 
keys is vital because they connect dimensions to the fact table. They also enforce a one-to-many relationship, because unless otherwise specified, a foreign key
can appear more than once in a table and primary key can appear only once.

The fact_booksales table has three foreign keys: book_id, time_id, and store_id. In this exercise, the four tables that make up the star schema below have been 
loaded. However, the foreign keys still need to be added. 

Instructions

- [x] In the constraint called sales_book, set book_id as a foreign key.
- [x] In the constraint called sales_time, set time_id as a foreign key.
- [x] In the constraint called sales_store, set store_id as a foreign key.

```sql
-- Add the book_id foreign key
ALTER TABLE fact_booksales ADD CONSTRAINT sales_book
    FOREIGN KEY (book_id) REFERENCES dim_book_star (book_id);
    
-- Add the time_id foreign key
ALTER TABLE fact_booksales ADD CONSTRAINT sales_time
    FOREIGN KEY (time_id) REFERENCES dim_time_star (time_id);
    
-- Add the store_id foreign key
ALTER TABLE fact_booksales ADD CONSTRAINT sales_store
    FOREIGN KEY (store_id) REFERENCES dim_store_star (store_id);
```

## Extending the book dimension
In the video, we saw how the book dimension differed between the star and snowflake schema. The star schema's dimension table for books, dim_book_star, has been loaded and below is the snowflake schema of the book dimension. 

In this exercise, you are going to extend the star schema to meet part of the snowflake schema's criteria. Specifically, you will create dim_author from the data provided in dim_book_star.

Instructions 1/2
- [x] Create dim_author with a column for author.
- [x] Insert all the distinct authors from dim_book_star into dim_author.

```sql
-- Create dim_author with an author column
CREATE TABLE dim_author (
    author varchar(256)  NOT NULL
);

-- Insert authors into the new table
INSERT INTO dim_author
SELECT DISTINCT author FROM dim_book_star;
```
Instructions 2/2
- [x] Alter dim_author to have a primary key called author_id.
- [x] Output all the columns of dim_author
```sql
-- Add a primary key 
ALTER TABLE dim_author ADD COLUMN author_id SERIAL PRIMARY KEY;

-- Output the new table
SELECT * FROM dim_author;
```
      

